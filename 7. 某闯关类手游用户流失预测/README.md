## 一、背景

手游在当下的日常娱乐中占据着主导性地位，成为人们生活中放松身心的一种有效途径。近年来，各种类型的手游，尤其是闯关类的休闲手游，由于其对碎片化时间的利用取得了非常广泛的市场。然而在此类手游中，新用户流失是一个非常严峻的问题，有相当多的新用户在短暂尝试后会选择放弃，而如果能在用户还没有完全卸载游戏的时候针对流失可能性较大的用户施以干预（例如奖励道具、暖心短信），就可能挽回用户从而提升游戏的活跃度和公司的潜在收益，因此用户的流失预测成为一个重要且挑战性的问题。在毕业项目中我们将从真实游戏中非结构化的日志数据出发，构建用户流失预测模型，综合已有知识设计适合的算法解决实际问题。

## 二、任务

* 根据给出的实际数据（包括用户游玩历史，关卡特征等），预测测试集中的用户是否为流失用户（二分类）；
* 提交代码与实验报告，报告展示对数据的观察、分析、最后的解决方案以及不同尝试的对比等。

## 三、评价指标
AUC

## 四、数据概览

本次使用的是一个休闲类闯关手游的数据，用户在游戏中不断闯关，每一关的基本任务是在限定步数内达到某个目标。每次闯关可能成功也可能失败，一般情况下用户只在完成一关后进入下一关，闯关过程中可以使用道具或提示等帮助。

对大多数手游来说，用户流失往往发生在早期，因此次周的留存情况是公司关注的一个重点。本次数据选取了 2020.2.1 注册的所有用户在 2.1-2.4 的交互数据，数据经过筛选保证这些注册用户在前四日至少有两日登录。流失的定义则参照次周（2.7-2.13）的登录情况，如果没有登录为流失。

本次的数据和结构化的形式不同，展现的是更原始的数据记录，更接近公司实际日志的形式，共包含 5 个文件：
## 4.1train.csv
训练集用户，包括用户 id（从 1 开始）以及对应是否为流失用户的 label（1：流失，0：留存）。

训练集共 8158 个用户，其中流失用户大约占 1/3，需要注意的是为了匿名化，这里数据都经过一定的非均匀抽样处理，流失率并不反映实际游戏的情况，用户与关卡的 id 同样经过了重编号，但对于流失预测任务来说并没有影响。
## 4.2dev.csv
验证集格式和训练集相同，主要为了方便离线测试与模型选择。

## 4.3test.csv
测试集只包含用户 id，任务就是要预测这些用户的流失概率。

## 4.4level_seq.csv
这个是核心的数据文件，包含用户游玩每个关卡的记录，每一条记录是对某个关卡的一次尝试，具体每列的含义如下：
* user_id：用户 id，和训练、验证、测试集中的可以匹配；
* level_id：关卡 id；
* f_success：是否通关（1：通关，0：失败）；
* f_duration：此次尝试所用的时间（单位 s）；
* f_reststep：剩余步数与限定步数之比（失败为 0）；
* f_help：是否使用了道具、提示等额外帮助（1：使用，0：未使用）；
* time：时间戳。

## 4.5level_meta.csv
每个关卡的一些统计特征，可用于表示关卡，具体每列的含义如下：
* f_avg_duration：平均每次尝试花费的时间（单位 s，包含成功与失败的尝试）；
* f_avg_passrate：平均通关率；
* f_avg_win_duration：平均每次通关花费的时间（单位 s，只包含通关的尝试）；
* f_avg_retrytimes：平均重试次数（第二次玩同一关算第 1 次重试）；
* level_id：关卡 id，可以和 level_seq.csv 中的关卡匹配。



### 5.2缺失数据处理
### 5.3数据观测
### 5.5数据再处理
在数据观测中，通过箱线图观测，用户技能、用户使用帮助次数和用户总花费时间存在明显离群数据。继续用箱型图判断异常点，把离群数据置为箱型图上下边缘值。

## 五、特征工程
总体思路：根据游玩关卡的记录为每个用户提取特征 → 结合 label 构建表格式的数据集 → 使用不同模型训练与测试；
### 5.1特征构造
按用户重游玩每个关卡的记录，构数据集为每个用户为一个样本，提取以下特征： 
* user_win_rate_tail：用户最后5%场次的胜率
* user_level_skill：用户技能
* user_active：用户活跃度
* user_help:用户使用帮助次数
* user_login_days:用户登录天数
* user_last_login:用户最后登录时间
* user_duration:用户总花费时间
### 5.2缺失数据处理
### 5.3数据观测
### 5.5数据再处理
在数据观测中，通过箱线图观测，用户技能、用户使用帮助次数和用户总花费时间存在明显离群数据。继续用箱型图判断异常点，把离群数据置为箱型图上下边缘值。

## 六、模型及调优
####  详见 train.ipynb

---
---
## 环境参考：

| model | version |
|----------|----------|
| python                    | 3.10.13 |
| matplotlib                | 3.4.3 |
| numpy                     | 1.22.3 |
| pandas                    | 1.5.3 |
| prettytable               | 3.10.0 |
| scikit-learn              | 1.3.0 |
| scipy                     | 1.8.1 |
| seaborn                   | 0.12.2 |
