## 一、背景
电子邮件是互联网的一项重要服务，在大家的学习、工作和生活中会广泛使用。但是大家的邮箱常常被各种各样的垃圾邮件填充了。有统计显示，每天互联网上产生的垃圾邮件有几百亿近千亿的量级。因此，对电子邮件服务提供商来说，垃圾邮件过滤是一项重要功能。而朴素贝叶斯算法在垃圾邮件识别任务上一直表现非常好，至今仍然有很多系统在使用朴素贝叶斯算法作为基本的垃圾邮件识别算法。

本次实验数据集来自[Trec06](https://plg.uwaterloo.ca/cgi-bin/cgiwrap/gvcormac/foo06)的中文垃圾邮件数据集，目录解压后包含三个文件夹，其中data目录下是所有的邮件（未分词），已分词好的邮件在data_cut目录下。邮件分为邮件头部分和正文部分，两部分之间一般有空行隔开。标签数据在label文件夹下，文件中每行是标签和对应的邮件路径。‘spam’表示垃圾邮件，‘ham’表示正常邮件。

## 二、任务
提取正文部分的文本特征，划分训练集和测试集，对比特征数目（词表大小）对模型效果的影响；尝试自行实现朴素贝叶斯算法细节；对比不同的概率计算方法。


## 三、评价指标
使用朴素贝叶斯算法完成垃圾邮件的分类与预测，要求测试集准确率Accuracy、精准率Precision、召回率Recall均高于0.9。



## 四、实验分析
本次实验数据集来自Trec06的中文垃圾邮件数据集，目录解压后包含三个文件夹，其中data目录下是所有的邮件（未分词），已分词好的邮件在data_cut目录下。邮件分为邮件头部分和正文部分，两部分之间一般有空行隔开。标签数据在label文件夹下，文件中每行是标签和对应的邮件路径。‘spam’表示垃圾邮件，‘ham’表示正常邮件。

识别垃圾邮件已经很很多前人的经验：需要大样本的训练集，我们已经具备；不能忽略邮件头，我们打算对加不加入邮件头作个对比；只使用最显著的少数的词，我们打算对比词表大小对结果的影响。

根据课程的学习，朴素贝叶斯分类器很适合用来识别垃圾邮件。但模型差异主要来自于特征的提取方式不同和分布时的所做的假设不同。提取方式考虑CountVectorizer和TfidfVectorizer；所做的假设不同考虑多项式朴素贝叶斯分类器（MultinomialNB）, 伯努利朴素贝叶斯分类器
（BernoulliNB), 补码朴素贝叶斯分类器（ComplementNB)，高斯贝叶斯分类器（GaussianNB）。

针对垃圾邮件识别，假阳性的代价远高于假阴性。因此，模型评价上，在accuracy和recall满足“大于0.9”的基础上，我们选择优先选择precision最好的值。再考虑其它参数。


## 五、模型训练过程及结果
####  详见 train.ipynb

## 六、小结
本例中的模型，特征的提取方式不同和分布时的所做的假设不同。经过反复对比，有以下结论：
* 针对邮件识别，假阳性的代价远高于假阴性。因此，在accuracy和recall满足“大于0.9”的基础上，我们选择优先选择precision最好的值。MultinomialNB、BernoulliNB、ComplementNB、GaussianNB的最好precision值分别为0.980309761、0.992146597，0.983061175、0.988765402。我们认为GaussianNB的效果最优（采用CountVectorizer，最大20个特征词）。 模型评价：accuracy为0.974157；precision为0.992147；recall为0.968859；F1为0.980364。
* 邮件头的处理很重要。在“4.2数据集读取、处理和划分”的提取的邮件内容包含正文和处理过的邮件头中，是否考虑邮件头，对不同分类器的accuracy、precision、recall最优值的影响都不一样，但考虑邮件头的情况下都有提升。
* 不同个数特征带来的影响：随着特征数的增多，准确率呈现在各个不同的分类器上表现出不同的特征： 多项式朴素贝叶斯分类器（MultinomialNB）和 补码朴素贝叶斯分类器（ComplementNB) 准确率呈现先上升后下降，到200时基本平稳；伯努利朴素贝叶斯分类器（BernoulliNB) 和 高斯贝叶斯分类器（GaussianNB） 准确率呈现先上升后下降的趋势。
* 本次实验因为经验和时间的影响，未自已实现朴素贝叶斯分类器。对比了sklearn的四个分类器，都非常优秀。


## 环境参考：

| model | version |
|----------|----------|
| jieba                     | 0.42.1 |
| python                    | 3.10.13 |
| matplotlib                | 3.4.3 |
| matplotlib-inline         | 0.1.6 |
| pandas                    | 1.5.3 |
| scikit-learn              | 1.3.0 |
| wordcloud                 | 1.9.3 |